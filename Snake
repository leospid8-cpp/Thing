#include <iostream>
#include <conio.h>
#include <windows.h>
#include <vector>
#include <ctime>
#include <cstdlib>
#include <algorithm>
 
using namespace std;
 
const int WIDTH = 25;
const int HEIGHT = 15;
const int MAX_TAIL = 100;
 
enum Direction { STOP, UP, DOWN, LEFT, RIGHT };
 
class SnakeGame {
private:
    bool gameOver;
    int x, y;
    int fruitX, fruitY;
    int score;
    int tailX[MAX_TAIL];
    int tailY[MAX_TAIL];
    int nTail;
    Direction dir;
    int speed;
    bool walls;
    
public:
    SnakeGame() : gameOver(false), score(0), nTail(0), dir(STOP), speed(100), walls(true) {
        x = WIDTH / 2;
        y = HEIGHT / 2;
        srand(static_cast<unsigned>(time(0)));
        placeFruit();
    }
    
    void placeFruit() {
        bool onSnake;
        do {
            onSnake = false;
            fruitX = rand() % WIDTH;
            fruitY = rand() % HEIGHT;
            
            if (fruitX == x && fruitY == y) onSnake = true;
            for (int i = 0; i < nTail; i++) {
                if (tailX[i] == fruitX && tailY[i] == fruitY) {
                    onSnake = true;
                    break;
                }
            }
        } while (onSnake);
    }
    
    void draw() {
        system("cls");
        
        cout << "╔";
        for (int i = 0; i < WIDTH; i++) cout << "═";
        cout << "╗" << endl;
        
        for (int i = 0; i < HEIGHT; i++) {
            cout << "║";
            for (int j = 0; j < WIDTH; j++) {
                if (i == y && j == x)
                    cout << "●";
                else if (i == fruitY && j == fruitX)
                    cout << "★";
                else {
                    bool printed = false;
                    for (int k = 0; k < nTail; k++) {
                        if (tailX[k] == j && tailY[k] == i) {
                            cout << (k == 0 ? "○" : "◎");
                            printed = true;
                            break;
                        }
                    }
                    if (!printed) cout << " ";
                }
            }
            cout << "║" << endl;
        }
        
        cout << "╚";
        for (int i = 0; i < WIDTH; i++) cout << "═";
        cout << "╝" << endl;
        
        cout << "\nScore: " << score << "  |  Length: " << nTail + 1 << "  |  Speed: " << 110 - speed;
        cout << "\nControls: W A S D | X: Exit | P: Pause | W: Walls " << (walls ? "ON" : "OFF") << "\n";
    }
    
    void input() {
        if (_kbhit()) {
            char key = _getch();
            switch (tolower(key)) {
                case 'w': if (dir != DOWN) dir = UP; break;
                case 's': if (dir != UP) dir = DOWN; break;
                case 'a': if (dir != RIGHT) dir = LEFT; break;
                case 'd': if (dir != LEFT) dir = RIGHT; break;
                case 'x': gameOver = true; break;
                case 'p': pauseGame(); break;
                case 't': walls = !walls; break;
                case '+': if (speed > 50) speed -= 10; break;
                case '-': if (speed < 200) speed += 10; break;
            }
        }
    }
    
    void pauseGame() {
        system("cls");
        cout << "\n\n    GAME PAUSED\n";
        cout << "    Press any key to continue...";
        _getch();
    }
    
    void logic() {
        if (dir == STOP) return;
        
        int prevX = tailX[0];
        int prevY = tailY[0];
        tailX[0] = x;
        tailY[0] = y;
        
        for (int i = 1; i < nTail; i++) {
            swap(tailX[i], prevX);
            swap(tailY[i], prevY);
        }
        
        switch (dir) {
            case UP: y--; break;
            case DOWN: y++; break;
            case LEFT: x--; break;
            case RIGHT: x++; break;
        }
        
        if (walls) {
            if (x < 0 || x >= WIDTH || y < 0 || y >= HEIGHT) {
                gameOver = true;
                return;
            }
        } else {
            if (x < 0) x = WIDTH - 1;
            else if (x >= WIDTH) x = 0;
            if (y < 0) y = HEIGHT - 1;
            else if (y >= HEIGHT) y = 0;
        }
        
        for (int i = 0; i < nTail; i++) {
            if (tailX[i] == x && tailY[i] == y) {
                gameOver = true;
                return;
            }
        }
        
        if (x == fruitX && y == fruitY) {
            score += 10;
            nTail = min(nTail + 1, MAX_TAIL - 1);
            placeFruit();
            
            if (score % 50 == 0 && speed > 50) {
                speed -= 5;
            }
        }
    }
    
    void run() {
        while (!gameOver) {
            draw();
            input();
            logic();
            
            if (!gameOver) {
                Sleep(speed);
            }
        }
        
        gameOverScreen();
    }
    
    void gameOverScreen() {
        system("cls");
        cout << "\n\n    ╔══════════════════════╗\n";
        cout << "    ║     GAME OVER!      ║\n";
        cout << "    ╚══════════════════════╝\n\n";
        cout << "    Final Score: " << score << "\n";
        cout << "    Snake Length: " << nTail + 1 << "\n\n";
        cout << "    Press any key to exit...";
        _getch();
    }
};
 
int main() {
    SnakeGame game;
    game.run();
    return 0;
}
